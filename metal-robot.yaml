---
clients:
- name: metal-stack-github
  organization: metal-stack
  github:
    app-id: 72006
    key-path: key.pem
- name: fc-native-github
  organization: fc-native
  github:
    app-id: 75591
    key-path: fc-native.pem
# - name: fits-gitlab
#   organization: cloud-native
#   gitlab:
#     token: ...

webhooks:
- serve-path: /github/webhooks/metal-stack
  secret: something
  vcs: github
  actions:
    - type: create-repository-maintainers
      client: metal-stack-github

    - type: docs-preview-comment
      client: metal-stack-github
      args:
        comment-tpl: |
          Thanks for contributing a pull request to the metal-stack docs!

          A rendered preview of your changes will be available at: https://docs.metal-stack.io/previews/PR%d/
        repository: docs

    # just for testing
    # - type: release-vector
    #   client: metal-stack-github
    #   args:
    #     repository: metal-robot
    #     repository-url: "https://github.com/metal-stack/metal-robot"
    #     repos:
    #       metal-robot:
    #       - type: yaml-path-version-patch
    #         args:
    #           file: "deploy/kubernetes.yaml"
    #           yaml-path: "metadata.name"

    - type: release-vector
      client: metal-stack-github
      args:
        repository: releases
        repository-url: https://github.com/metal-stack/releases
        repos:
          metal-api:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.control-plane.metal-api.tag"
              version-compare: true

          masterdata-api:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.control-plane.masterdata-api.tag"
              version-compare: true

          metal-console:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.control-plane.metal-console.tag"
              version-compare: true

          metalctl:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.control-plane.metalctl.tag"
              version-compare: true

          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "binaries.metal-stack.metalctl.version"
              template: "https://github.com/metal-stack/metalctl/releases/download/v%s/metalctl-linux-amd64"
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "binaries.metal-stack.metalctl.linux.url"
              template: "https://github.com/metal-stack/metalctl/releases/download/v%s/metalctl-linux-amd64"
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "binaries.metal-stack.metalctl.windows.url"
              template: "https://github.com/metal-stack/metalctl/releases/download/v%s/metalctl-windows-amd64"
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "binaries.metal-stack.metalctl.darwin.url"
              template: "https://github.com/metal-stack/metalctl/releases/download/v%s/metalctl-darwin-amd64"

          metal-core:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.partition.metal-core.tag"
              version-compare: true

          ipmi-catcher:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.control-plane.ipmi-catcher.tag"
              version-compare: true

          backup-restore-sidecar:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.generic.backup-restore-sidecar.tag"
              version-compare: true

          metal-dockerfiles:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.generic.deployment-base.tag"
              version-compare: true

          gardener-extension-provider-metal:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.gardener.gardener-extension-provider-metal.tag"
              version-compare: true

          os-metal-extension:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.gardener.os-metal-extension.tag"
              version-compare: true

          firewall-controller:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.gardener.firewall-controller.tag"
              version-compare: true

          csi-lvm:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.kubernetes.csi-lvm-controller.tag"
              version-compare: true
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.kubernetes.csi-lvm-provisioner.tag"
              version-compare: true

          metal-ccm:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.kubernetes.metal-ccm.tag"
              version-compare: true

          kubernetes-splunk-audit-webhook:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "docker-images.metal-stack.kubernetes.splunk-audit-webhook.tag"
              version-compare: true

          metal-roles:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "ansible-roles.metal-roles.version"
              version-compare: true

          ansible-common:
          - type: yaml-path-version-patch
            args:
              file: "release.yaml"
              yaml-path: "ansible-roles.ansible-common.version"
              version-compare: true

    - type: swagger-clients
      client: metal-stack-github
      args:
        repos:
          metal-api:
            - repository: metal-python
              repository-url: "https://github.com/metal-stack/metal-python"
              modifiers:
              - type: line-patch
                args:
                  file: metal_python/version.py
                  line: 1
                  template: "VERSION = '%s'"
            # just for testing
            # - repository: metal-robot
            #   repository-url: "https://github.com/metal-stack/metal-robot"
            # 	modifiers:
            # 	- type: line-patch
            # 		file: deploy/kubernetes.yaml
            # 		line: 1
            # 		template: "VERSION = '%s'"

# - vcs: github
#   serve-path: /github/webhooks/fc-native
#   handlers:
#     - type: create-repository-maintainers
#       client: fc-native-github
#       args:

#     - type: swagger-clients
#       client: fc-native-github
#       args:
#         auto-build-branch-prefix: "auto-generate/"
#         repos:
#           cloud-api:
#             - name: "cloud-go"
#               url: "https://github.com/fc-native/cloud-go"
#               modifiers:
#               - type: gitlab-file-replace
#                 file: cloud-api.json
#                 from-repo: https://git.f-i-ts.de/cloud-native/cloud-api
#                 from-file: spec/cloud-api.json
#                 from-client: fits-gitlab
